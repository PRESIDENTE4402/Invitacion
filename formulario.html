<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Confirmaci√≥n de asistencia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="css/style_formulario.css" />
    <!-- Google Fonts opcionales -->
    <link
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&family=Lora&family=Great+Vibes&display=swap"
        rel="stylesheet">
</head>

<body>

      <div id="desktop-warning">
  Este sitio est√° optimizado √∫nicamente para dispositivos m√≥viles üì±<br>
  Por favor, √°brelo desde un celular.
</div>
    <main class="page">
        <section class="card">
            <h1 class="title-script">Confirmaci√≥n de asistencia</h1>
            <p class="subtitle">Por favor ind√≠canos de parte de qui√©n vienes.</p>

            <!-- CARDS NOVIA / NOVIO -->
            <div class="rsvp-cards">
                <button type="button" class="rsvp-card" data-side="novia">
                    <h3>Invitado de la novia</h3>
                    <p>Familia y amigos de la novia</p>
                </button>

                <button type="button" class="rsvp-card" data-side="novio">
                    <h3>Invitado del novio</h3>
                    <p>Familia y amigos del novio</p>
                </button>
            </div>

            <!-- FORMULARIO (INICIALMENTE OCULTO) -->
            <form id="rsvpForm" class="rsvp-form is-hidden">
                <p class="rsvp-form-title">
                    Est√°s confirmando como <span id="selectedSideLabel"></span>
                </p>

                <!-- guarda si viene de la novia o del novio -->
                <input type="hidden" id="sideHidden" name="side" />

                <div class="field autocomplete">
                    <label for="guestName">Escribe tu nombre</label>
                    <input type="text" id="nombreInput" name="nombreInput" autocomplete="off"
                        placeholder="Empieza a escribir tu nombre‚Ä¶">
                    <ul id="suggestions" class="suggestions-list"></ul>
                </div>

                <div class="field">
                    <label for="telefonoInput">N√∫mero de tel√©fono</label>
                    <input type="tel" id="telefonoInput" name="telefono" placeholder="Ejemplo: 502 1234 5678"
                        maxlength="15">
                </div>

                <!-- Caja que aparece cuando NO se encuentra el nombre -->
                <div id="notFoundBox" class="not-found hidden">
                    <p>No encontramos tu nombre en la lista.<br>
                        Por favor contacta a:</p>

                    <div class="notfound-buttons">
                        <a href="https://wa.me/50258223192?" target="_blank" class="nf-btn novia">La Novia üíõ</a>
                        <a href="https://wa.me/50233970345?" target="_blank" class="nf-btn novio">El Novio ü§µ</a>
                    </div>
                </div>

                <div id="guestCountBox" class="guest-count hidden">
                    <label>Pase unicamente para</label>

                    <div class="counter">
                        <button type="button" id="btnMinus" class="btn-counter">‚àí</button>
                        <input type="number" id="guestCount" value="1" readonly>
                        <button type="button" id="btnPlus" class="btn-counter disabled" disabled>+</button>
                    </div>

                    <p id="guestLimitLabel" class="guest-limit"></p>
                </div>


                <!-- ============================
     SECCI√ìN DE HOTELES SUGERIDOS
     ============================ -->
                <!-- ============================
     SECCI√ìN DE HOTELES (OCULTA AL INICIO)
     ============================ -->




                <div class="field">
                    <label for="extraInfo">Mensaje (opcional)</label>
                    <textarea id="extraInfo" name="extraInfo" rows="3"
                        placeholder="¬°Ser√° un honor acompa√±arlos en su gran d√≠a!"></textarea>
                </div>

                <button type="submit" class="btn-primary">
                    Confirmar asistencia
                </button>

                <div id="nota-importante" class="nota-importante hidden">
                    <strong>Nota importante:</strong>
                    Antes de reservar hospedaje, es indispensable que confirmes tu asistencia a la boda.
                </div>

                <div id="hotelesBox" class="hoteles-box hidden">
                    <h3 class="hoteles-title">Hoteles cercanos para reservar üè®</h3>

                    <p class="hoteles-desc">
                        Algunas opciones de hoteles cerca del evento:
                    </p>

                    <div class="hotel-item">
                        <h4>Hotel Los Delfines Cubulco</h4>
                        <p>A 5 minutos del evento ‚Äî Habitaciones desde Q150 por pesona. 45781878</p>
                        <a class="hotel-btn" href="https://wa.me/50245781878" target="_blank">
                            Reservar por WhatsApp 
                        </a>
                        <a class="hotel-btn hotel-btn-call" href="tel:+50245781878">
                            Llamar al hotel 
                        </a>

                    </div>

                    <div class="hotel-item">
                        <h4>Hotel Don Alex</h4>
                        <p>A 5 minutos del evento ‚Äî Habitaciones desde Q125. 31977269</p>
                        <a class="hotel-btn" href="https://wa.me/50231977269" target="_blank">
                            Reservar por WhatsApp 
                        </a>

                        <a class="hotel-btn hotel-btn-call" href="tel:+50231977269">
                            Llamar al hotel 
                        </a>
                    </div>

                    <div class="hotel-item">
                        <h4>Hotel Magdalena</h4>
                        <p>A 5 minutos del evento. 49858570</p>
                        <a class="hotel-btn" href="https://wa.me/50249858570" target="_blank">
                            Reservar por WhatsApp 
                        </a>

                        <a class="hotel-btn hotel-btn-call" href="tel:+50249858570">
                            Llamar al hotel 
                        </a>
                    </div>

                    <div class="hotel-item">
                        <h4>Hotel Emanuel</h4>
                        <p>A 5 minutos del evento. 30177788</p>
                        <a class="hotel-btn" href="https://wa.me/50230177788" target="_blank">
                            Reservar por WhatsApp 
                        </a>

                        <a class="hotel-btn hotel-btn-call" href="tel:+50230177788">
                            Llamar al hotel 
                        </a>
                    </div>
                </div>


            </form>
        </section>
    </main>
    <!-- ‚ö†Ô∏è MODAL ELEGANTE DE CONFIRMACI√ìN -->
    <div id="niceAlert" class="nice-alert hidden">
        <div class="nice-alert-backdrop"></div>

        <div class="nice-alert-box">
            <h3 id="niceAlertTitle">¬°Gracias!</h3>
            <p id="niceAlertMessage">Tu confirmaci√≥n fue recibida.</p>

            <button id="niceAlertBtn" class="nice-alert-btn">Aceptar</button>
        </div>
    </div>

    <!-- JS -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // ============================
            // 1) LISTAS DE INVITADOS
            // ============================
            const invitados = {
                novia: [
                    { nombre: "JOSE LUIS GONZALEZ", cantidad: 2 },
                    { nombre: "EVA ALVARADO", cantidad: 1 },
                    { nombre: "FERNANDO GONZALEZ GARCIA", cantidad: 4 },
                    { nombre: "FREDDY GONZALEZ GARCIA", cantidad: 4 },
                    { nombre: "BYRON GONZALEZ GARCIA", cantidad: 6 },
                    { nombre: "LUIS GONZALEZ GARCIA", cantidad: 1 },
                    { nombre: "MARLENY CABALLEROS ALVARADO", cantidad: 5 },
                    { nombre: "LUIS GONZALEZ MAAS Y ESPOSA", cantidad: 2 },
                    { nombre: "VANESA GONZALEZ Y FAMILIA", cantidad: 3 },
                    { nombre: "CESAR AUGUSTO IZAGUIRRE Y ESPOSA", cantidad: 2 },
                    { nombre: "CESAR IZAGUIRRE GRACIA (TITIO) Y FAM.", cantidad: 4 },
                    { nombre: "CAROLINA IZAGUIRRE GARCIA Y FAM.", cantidad: 6 },
                    { nombre: "KAREN IZAGUIRRE GARCIA Y FAM.", cantidad: 2 },
                    { nombre: "JUAN CARLOS IZAGUIRRE GARCIA Y FAM.", cantidad: 3 },
                    { nombre: "ERICK GARCIA (FLOR)", cantidad: 4 },
                    { nombre: "MANUEL GARCIA (MANUELITO)", cantidad: 1 },
                    { nombre: "ANGELICA ALVARADO Y ESPOSO", cantidad: 2 },
                    { nombre: "FABIAN ALFONZO GARCIA ALVARADO", cantidad: 4 },
                    { nombre: "LUIS DAVID GARCIA CABALLEROS", cantidad: 3 },
                    { nombre: "MELVA GARCIA CABALLEROS", cantidad: 1 },
                    { nombre: "OVIDIO CABALLEROS", cantidad: 1 },
                    { nombre: "MIGUEL ANGEL REYES CABALLEROS", cantidad: 1 },
                    { nombre: "ROSELIA REYES CABALLEROS", cantidad: 1 },
                    { nombre: "IRMA GARCIA CABALLEROS", cantidad: 2 },
                    { nombre: "EMILIA ALVARADO", cantidad: 1 },
                    { nombre: "TERESO ALVARADO", cantidad: 1 },
                    { nombre: "EDGAR CABALLEROS JUAREZ", cantidad: 2 },
                    { nombre: "CONRADO REYES", cantidad: 2 },
                    { nombre: "BELMAN REYES", cantidad: 2 },
                    { nombre: "MARI BLANCA PE√ëA", cantidad: 1 },
                    { nombre: "MARISOL GARCIA", cantidad: 3 },
                    { nombre: "TIOFILO CABRERA", cantidad: 2 },
                    { nombre: "CORONADO ALVARADO", cantidad: 2 },
                    { nombre: "SAULO GONZALEZ BATRES", cantidad: 3 },
                    { nombre: "CECY ROSALES", cantidad: 2 },
                    { nombre: "SILVIA", cantidad: 2 },
                    { nombre: "ANGEL LUIS COY", cantidad: 1 },
                    { nombre: "MADOLYN CAMPOS", cantidad: 1 },
                    { nombre: "PERLA FLORES", cantidad: 1 },
                    { nombre: "XIMENA BETHANCOURT", cantidad: 1 },
                    { nombre: "DONATO Y FAM.", cantidad: 4 },
                    { nombre: "LUIS FERNANDO CABALLEROS", cantidad: 2 },
                    { nombre: "DAVID CABALLEROS (HERMANO LESLY)", cantidad: 2 },
                    { nombre: "FERNANDO CABALLEROS (HERMANO LESLY)", cantidad: 2 },
                    { nombre: "GLENDA ROSALYN GONZALEZ", cantidad: 2 },
                    { nombre: "OSCAR MENDEZ", cantidad: 1 },
                    { nombre: "RODOLFO LOPEZ AJIN", cantidad: 1 },
                    { nombre: "OLIVER HERNANDEZ", cantidad: 1 },
                    { nombre: "LUIS PEREZ PEREZ", cantidad: 1 },
                    { nombre: "BYRON JUAREZ", cantidad: 1 },
                    { nombre: "MIRNA COLINDRES", cantidad: 2 },
                    { nombre: "ANDREA MORALES LEMUS", cantidad: 1 },
                    { nombre: "PATRICIA HERNANDEZ CHAJON", cantidad: 2 },
                    { nombre: "OSCAR GUZMAN", cantidad: 2 },
                    { nombre: "ISRAEL DE DIOS", cantidad: 2 },
                    { nombre: "GLEN GALVEZ", cantidad: 1 },
                ],
                novio: [
                    { nombre: "ARMANDO RODRIGUEZ", cantidad: 1 },
                    { nombre: "MARITZA RODRIGUEZ", cantidad: 1 },
                    { nombre: "YOSELIN CASTILLO", cantidad: 2 },
                    { nombre: "LUIS FERNANDO CASTILLO", cantidad: 5 },
                    { nombre: "LOURDES CASTILLO", cantidad: 4 },
                    { nombre: "MARIA ELENA LOPEZ (TIA NECA)", cantidad: 3 },
                    { nombre: "DANILO GONZALEZ", cantidad: 2 },
                    { nombre: "JUAN PABLO AGUIRRE", cantidad: 2 },
                    { nombre: "ALEJANDRO AGUIRRE", cantidad: 2 },
                    { nombre: "ALAN AGUIRRE", cantidad: 2 },
                    { nombre: "PABLO RODRIGUEZ", cantidad: 3 },
                    { nombre: "LIZ RODRIGUEZ", cantidad: 5 },
                    { nombre: "MARIA LISAMARTI TOLEDO", cantidad: 1 },
                    { nombre: "JOSE TOLEDO", cantidad: 1 },
                    { nombre: "DIEGO TOLEDO", cantidad: 1 },
                    { nombre: "OSWALDO FIGUEROA", cantidad: 1 },
                    { nombre: "JORGE LUIS LOPEZ", cantidad: 2 },
                    { nombre: "CARLOS CASTILLO", cantidad: 2 },
                    { nombre: "PEDRO CASTILLO", cantidad: 2 },
                    { nombre: "WILLIAM BARRIOS", cantidad: 2 },
                    { nombre: "ESTUARDO MORAN", cantidad: 4 },
                    { nombre: "AMADA LOPEZ", cantidad: 1 },
                    { nombre: "DIEGO DIAZ", cantidad: 2 },
                    { nombre: "RICARDO ARAGON", cantidad: 1 },
                    { nombre: "HEYDI AIME VILLAGRAN", cantidad: 1 },
                    { nombre: "EDWIN RAMIREZ ANDRADE", cantidad: 2 },
                    { nombre: "HERNANDEZ PELICO", cantidad: 1 },
                    { nombre: "ABEL PRADO", cantidad: 1 },
                    { nombre: "RUDY REYNOSO", cantidad: 2 },
                    { nombre: "ALFARO BARRIENTOS", cantidad: 2 },
                    { nombre: "OSCAR CARRANZA", cantidad: 1 },
                    { nombre: "BRANDY ALLAY", cantidad: 1 },
                    { nombre: "CARLOS URIZAR", cantidad: 1 },
                    { nombre: "ISMAEL REYES", cantidad: 1 },
                    { nombre: "EGDAR CHOY", cantidad: 1 },
                    { nombre: "SERGIO BOLVITO", cantidad: 1 },
                    { nombre: "CARLOS VASQUEZ", cantidad: 1 },
                    { nombre: "CAAL JUC", cantidad: 1 },
                    { nombre: "BYRON RAC", cantidad: 1 },
                    { nombre: "WILLIAM CANEL", cantidad: 1 },            
                    { nombre: "JACOB MORATAYA", cantidad: 1 },
                    { nombre: "JAVIER MONTES", cantidad: 1 },
                    { nombre: "BRANDOL GARCIA MEJIA", cantidad: 1 },
                    { nombre: "KENVIN SOSA", cantidad: 1 },
                    { nombre: "ERICK MORAN", cantidad: 1 },
                    { nombre: "JENNIFER JIMENEZ Y RONALD CASTELLANOS", cantidad: 2 },
                    { nombre: "HUGO MORALES BATZ", cantidad: 1 },
                    { nombre: "LUIS HERNANDEZ URIZAR", cantidad: 1 },
                    { nombre: "HENRY VASQUEZ", cantidad: 1 },
                    { nombre: "CARLOS ROMERO", cantidad: 1 },
                    { nombre: "WANDA VALENZUELA", cantidad: 1 },
                    { nombre: "BRYAN MIRON", cantidad: 1 },
                    { nombre: "LESLY VICTORIA REYES", cantidad: 2 },
                    { nombre: "ANA OVALLE", cantidad: 1 },
                    { nombre: "EDWIN MEDINA", cantidad: 1 },
                    { nombre: "ERICKA ZU√ëIGA", cantidad: 1 },
                    { nombre: "GLORIA ACETUN CU", cantidad: 1 },
                    { nombre: "MARLON ZECE√ëA", cantidad: 1 },
                    { nombre: "DANILO GARCIA PEREZ", cantidad: 2 },
                    { nombre: "AMILCAR JUAREZ ROMERO", cantidad: 2 },
                    { nombre: "PEDRO PINEDA RODAS", cantidad: 1 },
                    { nombre: "JULIO FERNADEZ", cantidad: 1 },
                    { nombre: "MANUEL CUA XICO", cantidad: 1 },
                    { nombre: "BRIAN MARIN ARANA", cantidad: 1 },
                    { nombre: "IDELFONSO UCELO", cantidad: 1 },
                    { nombre: "JULIO CESAR TARACENA", cantidad: 2 },
                    { nombre: "ANGEL DARIO FERNANDEZ DUBON", cantidad: 2 },
                    { nombre: "SERGIO M√âRIDA ROJAS", cantidad: 2 },
                    { nombre: "CRISTINA LEONARDA TOJ", cantidad: 1 },
                    { nombre: "EDWIN RAMOS GARCIA", cantidad: 2 },
                    { nombre: "LESTER FRANCO ALEGRIA", cantidad: 1 },

                ]
            };

            // ============================
            // 2) ELEMENTOS DEL DOM
            // ============================
            const cards = document.querySelectorAll(".rsvp-card");
            const form = document.getElementById("rsvpForm");
            const guestInput = document.getElementById("nombreInput");
            const telefonoInput = document.getElementById("telefonoInput");
            const suggestionBox = document.getElementById("suggestions");
            const notFoundBox = document.getElementById("notFoundBox");
            const sideHidden = document.getElementById("sideHidden");
            const sideLabel = document.getElementById("selectedSideLabel");
            const extraInfo = document.getElementById("extraInfo");
            const guestCountBox = document.getElementById("guestCountBox");
            const guestCountInput = document.getElementById("guestCount");
            const hotelesBox = document.getElementById("hotelesBox");
            const nota_importante = document.getElementById("nota-importante");


            // Si falta algo cr√≠tico, no seguimos para evitar errores
            if (!form || !guestInput || !telefonoInput || !suggestionBox || !sideHidden || !sideLabel) {
                console.error("Faltan elementos necesarios en el DOM para el formulario de RSVP.");
                return;
            }

            // Lista actual (novia / novio)
            let listaActiva = [];
            // Busca el invitado por el texto escrito y muestra la cantidad (si coincide exactamente)
            function aplicarCantidadPorNombre() {
                if (!guestInput || !listaActiva.length) return;

                const nombreEscrito = guestInput.value.trim().toLowerCase();
                if (!nombreEscrito) return;

                const invitadoObj = listaActiva.find(inv =>
                    inv.nombre.toLowerCase() === nombreEscrito
                );

                if (invitadoObj) {
                    mostrarCantidad(invitadoObj.cantidad);
                    if (hotelesBox) hotelesBox.classList.remove("hidden");
                    if (nota_importante) nota_importante.classList.remove("hidden");
                }
            }


            // ============================
            // 3) CLICK EN UNA CARD
            // ============================
            cards.forEach(card => {
                card.addEventListener("click", () => {
                    const side = card.dataset.side; // "novia" o "novio"

                    // marcar visualmente
                    cards.forEach(c => c.classList.remove("is-active"));
                    card.classList.add("is-active");

                    // texto visible
                    sideLabel.textContent = side === "novia"
                        ? "invitado de la novia"
                        : "invitado del novio";

                    // guardar lado seleccionado
                    sideHidden.value = side;

                    // activar lista correspondiente
                    listaActiva = invitados[side] || [];

                    // limpiar input y sugerencias
                    guestInput.value = "";
                    telefonoInput.value = "";
                    suggestionBox.innerHTML = "";
                    suggestionBox.style.display = "none";
                    if (notFoundBox) notFoundBox.classList.add("hidden");
                    if (guestCountBox) guestCountBox.classList.add("hidden");
                    if (hotelesBox) hotelesBox.classList.add("hidden");
                    if (nota_importante) nota_importante.classList.add("hidden");


                    // mostrar formulario
                    form.classList.remove("is-hidden");
                    form.scrollIntoView({ behavior: "smooth", block: "start" });
                });
            });

            // ============================
            // 4) AUTOCOMPLETE DEL NOMBRE
            // ============================
            guestInput.addEventListener("input", function () {
                const query = this.value.toLowerCase().trim();
                suggestionBox.innerHTML = "";
                suggestionBox.style.display = "none";
                if (notFoundBox) notFoundBox.classList.add("hidden");

                if (!query || listaActiva.length === 0) {
                    return;
                }

                // Filtrar por nombre del objeto
                const matches = listaActiva.filter(invitado =>
                    invitado.nombre.toLowerCase().includes(query)
                );

                if (matches.length === 0) {
                    // si quieres mostrar el aviso de "no est√°s en la lista" mientras escribe,
                    // descomenta la siguiente l√≠nea:
                    // if (notFoundBox) notFoundBox.classList.remove("hidden");
                    return;
                }

                matches.forEach(invitado => {
                    const li = document.createElement("li");
                    li.textContent = invitado.nombre.trim();

                    li.addEventListener("click", () => {
                        guestInput.value = invitado.nombre;
                        suggestionBox.innerHTML = "";
                        suggestionBox.style.display = "none";

                        // MOSTRAR CANTIDAD (contador que solo puede disminuir)
                        mostrarCantidad(invitado.cantidad);
                        if (hotelesBox) hotelesBox.classList.remove("hidden");
                        if (nota_importante) nota_importante.classList.remove("hidden");
                    });

                    suggestionBox.appendChild(li);
                });

                suggestionBox.style.display = "block";
            });

            // Ocultar sugerencias si clic fuera del autocomplete
            document.addEventListener("click", (e) => {
                if (!e.target.closest(".autocomplete")) {
                    suggestionBox.style.display = "none";
                }
            });
            // Cuando el usuario termina de escribir y sale del campo, intentamos aplicar la cantidad
            guestInput.addEventListener("blur", aplicarCantidadPorNombre);


            // ============================
            // 5) ENV√çO DEL FORMULARIO
            // ============================
            form.addEventListener("submit", function (e) {
                e.preventDefault();

                const lado = sideHidden.value || "";
                const invitado = guestInput.value ? guestInput.value.trim() : "";
                const numero = telefonoInput.value ? telefonoInput.value.trim() : "";
                const mensaje = extraInfo && extraInfo.value
                    ? extraInfo.value.trim()
                    : "";

                if (!lado) {
                    mostrarAlerta("Falta informaci√≥n", "Por favor selecciona si eres invitado de la novia o del novio.");
                    return;
                }

                if (!invitado) {
                    mostrarAlerta("Falta tu nombre", "Por favor escribe tu nombre.");
                    return;
                }
                if (!numero) {
                    mostrarAlerta("Falta tu numero", "Por favor escribe tu numero.");
                    return;
                }

                // Verificar que el nombre est√© realmente en la lista
                // Buscar el invitado en la lista (objeto con nombre + cantidad)
                const invitadoObj = listaActiva.find(
                    inv => inv.nombre.toLowerCase() === invitado.toLowerCase()
                );

                if (!invitadoObj) {
                    if (notFoundBox) notFoundBox.classList.remove("hidden");
                    mostrarAlerta(
                        "Nombre no encontrado",
                        "Tu nombre no aparece en la lista. Por favor contacta a la novia o al novio üíõ"
                    );
                    return;
                }

                // Nos aseguramos de que la cantidad est√© aplicada aunque no haya clic en la sugerencia
                // Si la caja de cantidad nunca se mostr√≥ (por ejemplo, escribi√≥ el nombre y no sali√≥ del input),
                // la mostramos por lo menos una vez con el m√°ximo permitido


                if (guestCountBox && guestCountBox.classList.contains("hidden")) {
                    mostrarCantidad(invitadoObj.cantidad);
                }

                // Tomamos la cantidad que el usuario dej√≥ seleccionada (si existe el input)
                let cantidadFinal = invitadoObj.cantidad; // valor por defecto

                if (guestCountInput && !guestCountBox.classList.contains("hidden")) {
                    const parsed = parseInt(guestCountInput.value, 10);
                    if (!isNaN(parsed) && parsed >= 1 && parsed <= invitadoObj.cantidad) {
                        cantidadFinal = parsed;
                    }
                }

                // Aqu√≠ podr√≠as hacer un fetch() para guardar la respuesta en tu servidor / Google Sheets
                console.log("Lado:", lado);
                console.log("Invitado:", invitado);
                console.log("Cantidad seleccionada:", cantidadFinal);
                console.log("Mensaje:", mensaje);

                // Enviar a Google Sheets
                // Enviar a Google Sheets SIN JSON, como formulario
                fetch("https://script.google.com/macros/s/AKfycbyIOnkbahQ_yqNA7csFIJNGv5mnwPHhY82hSLPIjQrUcIajzitUTAQtwHpcsbk0mts7Cw/exec", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/x-www-form-urlencoded",
                    },
                    body: new URLSearchParams({
                        lado: lado,
                        nombre: invitado,
                        numero: numero,
                        cantidad: cantidadFinal,
                        mensaje: mensaje
                    })
                })
                    .then(r => r.text())
                    .then(result => {
                        if (result.trim() === "ok_actualizado" || result.trim() === "ok_nuevo") {
                            console.log("¬°Confirmaci√≥n enviada con √©xito! Gracias por confirmar ‚ù§Ô∏è");
                        } else {
                            mostrarAlerta("Avisar por WhatsApp", "Por favor enviar mensaje de confirmaci√≥n a los novios por WhatsApp.", false, lado, invitado, cantidadFinal);
                            console.log("Hubo un peque√±o error: " + result);
                            
                        }
                    })
                    .catch(err => {
                        console.error(err);
                        console.log("Error de conexi√≥n. Prueba con WhatsApp por favor.");
                    });




                mostrarAlerta(
                    "¬°Listo!",
                    `¬°Gracias ${invitado.split(" ")[0]}! Tu asistencia qued√≥ confirmada para ${cantidadFinal} persona${cantidadFinal > 1 ? "s" : ""}. ¬°Nos vemos!`,
                    true, lado, invitado, cantidadFinal  // ‚Üê ESTE "true" activa el borrado de cach√© solo aqu√≠
                );
                

                // Reset visual
                form.reset();
                form.classList.add("is-hidden");
                sideHidden.value = "";
                sideLabel.textContent = "";
                suggestionBox.innerHTML = "";
                suggestionBox.style.display = "none";
                if (notFoundBox) notFoundBox.classList.add("hidden");
                if (guestCountBox) guestCountBox.classList.add("hidden");
                if (hotelesBox) hotelesBox.classList.add("hidden");
                if (nota_importante) nota_importante.classList.add("hidden");

                cards.forEach(c => c.classList.remove("is-active"));
                // Fuerza recarga desde el servidor, no desde cach√©
                

            });
        });


        // ===============================
        // FUNCI√ìN PARA MOSTRAR ALERTA BONITA
        // ===============================
        function mostrarAlerta(titulo, mensaje, esConfirmacionFinal = false, lado = "", invitado = "", cantidadFinal = '') {
            const alertBox = document.getElementById("niceAlert");
            const titleEl = document.getElementById("niceAlertTitle");
            const messageEl = document.getElementById("niceAlertMessage");
            const buttonEl = document.getElementById("niceAlertBtn");

            if (!alertBox || !titleEl || !messageEl || !buttonEl) {
                alert(titulo + "\n\n" + mensaje);
                return;
            }

            titleEl.textContent = titulo;
            messageEl.textContent = mensaje;
            alertBox.classList.remove("hidden");

            // Solo si es la alerta de confirmaci√≥n exitosa, borramos cach√© al hacer clic en Aceptar
            buttonEl.onclick = async () => {
                alertBox.classList.add("hidden");

                if (esConfirmacionFinal && 'caches' in window) {
                    try {
                        const allCaches = await caches.keys();
                        for (const cacheName of allCaches) {
                            const cache = await caches.open(cacheName);
                            const requests = await cache.keys();
                            for (const request of requests) {
                                if (request.url.includes("script.google.com/macros")) {
                                    await cache.delete(request);
                                }
                            }
                        } 

                        if(lado && invitado && cantidadFinal)
                        enviarWhatsApp(lado, invitado, cantidadFinal);
                        console.log("Cach√© limpiada ‚Äì pr√≥xima confirmaci√≥n funcionar√° perfecto ");
                    } catch (err) {
                        // Silencioso: no molestamos al usuario si falla
                    }
                }
            };
        }

        const WHATSAPP_NOVIA = "50258223192";  // ya lo tienes en los links
        const WHATSAPP_NOVIO = "50233970345";

        function enviarWhatsApp(lado, invitado, cantidad) {
            const telefono = lado === "novia" ? WHATSAPP_NOVIA : WHATSAPP_NOVIO;

            const texto = `Hola, soy ${invitado}. 
            Confirmo mi asistencia como invitado de  ${lado === "novia" ? " la novia" : " del novio"} 
                para ${cantidad} ${cantidad === 1 ? "persona" : "personas"}.`;

            const url = `https://wa.me/${telefono}?text=${encodeURIComponent(texto)}`;
            window.open(url, "_blank");
        }

        // ===============================
        // FUNCI√ìN PARA MOSTRAR Y CONTROLAR CANTIDAD
        // ===============================
        function mostrarCantidad(maxCantidad) {
            const box = document.getElementById("guestCountBox");
            const guestCount = document.getElementById("guestCount");
            const minus = document.getElementById("btnMinus");
            const plus = document.getElementById("btnPlus");
            const limitLabel = document.getElementById("guestLimitLabel");

            if (!box || !guestCount || !minus || !plus || !limitLabel) {
                console.warn("Faltan elementos para el contador de invitados.");
                return;
            }

            // Setear valor inicial igual a la cantidad m√°xima
            guestCount.value = maxCantidad;

            // Mostrar texto
            limitLabel.textContent =
                maxCantidad === 1
                    ? "Invitaci√≥n individual."
                    : " personas. Puedes disminuir, pero no aumentar m√°s de " + maxCantidad + " personas.";

            // mostrar caja
            box.classList.remove("hidden");

            // Configurar bot√≥n + (siempre deshabilitado)
            plus.classList.add("disabled");
            plus.disabled = true;

            // Bot√≥n ‚àí solo deja bajar hasta 1
            minus.onclick = () => {
                let current = parseInt(guestCount.value, 10);
                if (current > 1) {
                    guestCount.value = current - 1;
                }
            };
        }


        document.addEventListener("DOMContentLoaded", function () {
  const isMobile = /Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(navigator.userAgent);

  if (!isMobile) {
    document.getElementById("desktop-warning").style.display = "block";
  }
});
    </script>



</body>

</html>